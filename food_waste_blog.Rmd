---
title: "Food Waste from California Agriculture"
author: "Warren Watts"
date: "October 4, 2018"
output: 
  html_document:
    theme: united
    highlight: tango
    fig_width: 10
    fig_height: 8
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```

## California Agricultural Production and Wasted Food

California is a major agricultural state, although most people don't think of agriculture when they think about California. Likewise wasted food is a major environmental problem that most people don't think about when they think about the environment. This blog is an attempt to dive into the available data and take a look at how much of California's edible agricultural output is wasted.

Food waste occurs at several levels. Food that has spoiled is thrown away in homes and grocery stores. Leftovers from restaurants and home cooking often go uneaten. Standards for produce also cause food waste as food is discarded that doesn't look beautiful enough to be bought at the grocery store. The USDA produces data for agricultural production and provides estimates of home and retail food waste for different commodities. The estimates for produce that is discarded to meet standards are less official. Both will be examined in attempt to see how much of California's agricultural production is wasted that could be eaten.

### California Agricultural Production Wasted at Home and Retail Levels
Home food waste has become even more obvious as more and more of us are asked to seperate our food waste from the rest of our garbage and we can see how much edible food or food that was once edible that we throw away. Food that is consumed in restaurants has a different path, but based on plate waste at restaraunts, it is a fair assumption that similar or greater amounts of food is wasted.

California is a major agricultural producer and leads the nation in productions of many types of food. The California Department of Food and Agriculture produces yearly statistical reports on California food production, which can be found [**at the CDFA's website**](https://www.cdfa.ca.gov/Statistics/). 

The U.S. Department of Agriculture has produced estimates of percentage of wasted food for different commodities at the home and retail level as part of *ERS Food Availability (Per Capita) Data System (FADS)*. [**Link to FADS Webpage**](https://www.ers.usda.gov/data-products/food-availability-per-capita-data-system/).  

The following charts were generated by compiling the last 5 years of California food production data and applying the food loss estimate from the FADS system, in particular the yearly Loss Adjusted Food Availability (LAFA) tables.


```{r graph_setup, include=FALSE}
# Code for creating visualization of california agricultural production
# from 2012 to 2016 with waste figures at different levels of production
# for all categories of crops and animal products.

# read in crop table files
crop_2016 <- read.table(file="calcrop2016.txt", header=TRUE, sep=" ")
crop_2015 <- read.table(file="calcrop2015.txt", header=TRUE, sep=" ")
crop_2014 <- read.table(file="calcrop2014.txt", header=TRUE, sep=" ")
crop_2013 <- read.table(file="calcrop2013.txt", header=TRUE, sep=" ")
crop_2012 <- read.table(file="calcrop2012.txt", header=TRUE, sep=" ")

# read in animal table files
animal_2016 <- read.table(file="calanim2016.txt", header=TRUE, sep=" ")
animal_2015 <- read.table(file="calanim2015.txt", header=TRUE, sep=" ")
animal_2014 <- read.table(file="calanim2014.txt", header=TRUE, sep=" ")
animal_2013 <- read.table(file="calanim2013.txt", header=TRUE, sep=" ")
animal_2012 <- read.table(file="calanim2012.txt", header=TRUE, sep=" ")

# read in file with yearly output and input costs
ag_bal <- read.table(file="cal_rev_cost_2012_2016.txt", header=TRUE, sep=" ")

# clip unnecessary columns from crop tables 
crop_2016 <- crop_2016[1:6]
crop_2015 <- crop_2015[1:6]
crop_2014 <- crop_2014[1:6]
crop_2013 <- crop_2013[1:6]
crop_2012 <- crop_2012[1:6]

# clip unnecessary columns from animal tables 
animal_2012 <- animal_2012[1:5]
animal_2013 <- animal_2013[1:5]
animal_2014 <- animal_2014[1:5]
animal_2015 <- animal_2015[1:5]
animal_2016 <- animal_2016[1:5]

# rename columns by year (unused)
#names(crop_2016)[2:6] <- paste(names(crop_2016[2:6]), "_2016", sep="")

# add year columns
crop_2016$year <- 2016
crop_2015$year <- 2015
crop_2014$year <- 2014
crop_2013$year <- 2013
crop_2012$year <- 2012
animal_2012$year <- 2012
animal_2013$year <- 2013
animal_2014$year <- 2014
animal_2015$year <- 2015
animal_2016$year <- 2016


# merge (used different approach)
#cal_crop <- merge(crop_2016[1:6], crop_2015[1:6],
#                 by="commodity", all=TRUE)

# put yearly crop data in single df
cal_crop <- rbind(crop_2016, crop_2015)
cal_crop <- rbind(cal_crop, crop_2014)
cal_crop <- rbind(cal_crop, crop_2013)
cal_crop <- rbind(cal_crop, crop_2012)

# put yearly animal data in single df
cal_animal <- rbind(animal_2016, animal_2015)
cal_animal <- rbind(cal_animal, animal_2014)
cal_animal <- rbind(cal_animal, animal_2013)
cal_animal <- rbind(cal_animal, animal_2012)

# create a crop production df 
cal_crop_prod <- cal_crop %>% select(commodity, year, production_kton)

# make index of NA values for production
prod_na <- which(is.na(cal_crop_prod[3]))

# find averages for missing production values
miss_prod_avg <- cal_crop_prod[!is.na(cal_crop_prod[3]),] %>%
                   filter(commodity %in% cal_crop_prod[prod_na,1]) %>%
                   group_by(commodity) %>%
                   summarise(avg = mean(production_kton))

# fill missing production values with 90% of average
cal_crop_prod[prod_na,3] <- miss_prod_avg[,2] * .9

# find missing commodities
# create yearly commodity lists
commod_2012 <- cal_crop_prod %>%
                 filter(year==2012) %>%
                 select(commodity)

commod_2013 <- cal_crop_prod %>%
  filter(year==2013) %>%
  select(commodity)

commod_2014 <- cal_crop_prod %>%
  filter(year==2014) %>%
  select(commodity)

commod_2015 <- cal_crop_prod %>%
  filter(year==2015) %>%
  select(commodity)

commod_2016 <- cal_crop_prod %>%
  filter(year==2016) %>%
  select(commodity)

commod_2012 <- commod_2012[[1]]
commod_2013 <- commod_2013[[1]]
commod_2014 <- commod_2014[[1]]
commod_2015 <- commod_2015[[1]]
commod_2016 <- commod_2016[[1]]

# check years to make sure that commodity names match
commod_2012[!commod_2012 %in% commod_2013]
commod_2013[!commod_2013 %in% commod_2012]
# no processed spinach after 2012
commod_2013[!commod_2013 %in% commod_2014]
commod_2013[!commod_2013 %in% commod_2015]
# 2013-2015 contain all the same commodities
commod_2013[!commod_2013 %in% commod_2016]
commod_2016[!commod_2016 %in% commod_2013]
# Processed and Fresh Market Strawberries combined in 2016
# Plumes and Prunes (Dried Plums) combined in 2016

# Create split 2012-2015 to divide combined 2016 commodities
split_com <- cal_crop_prod %>%
               filter(commodity %in% c("Strawberries_FM","Strawberries_Proc",
                                       "Plums", "Plums_Dried")) %>%
               group_by(commodity) %>%
               summarise(total_prod = sum(production_kton))

Straw_FM_split <- split_com[3,2]/(split_com[3,2]+split_com[4,2])
Straw_Proc_split <- split_com[4,2]/(split_com[3,2]+split_com[4,2])
Plums_split <- split_com[1,2]/(split_com[1,2]+split_com[2,2])
Plums_Dried_split <- split_com[2,2]/(split_com[1,2]+split_com[2,2])

# split 2016 data for strawberries and plums into seperate rows
Straw_2016 <- cal_crop_prod[which(cal_crop_prod[1] == "Strawberries_All"),3]
Plum_2016 <- cal_crop_prod[which(cal_crop_prod[1] == "Plums_Prunes"),3]
cal_crop_prod[nrow(cal_crop_prod)+1,] <- c("Strawberries_Proc", 2016, Straw_2016 * Straw_Proc_split)
cal_crop_prod[nrow(cal_crop_prod)+1,] <- c("Plums_Dried", 2016, Plum_2016 * Plums_Dried_split)
cal_crop_prod[which(cal_crop_prod[1] == "Strawberries_All"),] <- c("Strawberries_FM", 2016, Straw_2016 * Straw_FM_split)
cal_crop_prod[which(cal_crop_prod[1] == "Plums_Prunes"),] <- c("Plums", 2016, Plum_2016 * Plums_split)

# cal_crop_prod now has clean data for all 5 years

# create a animal production df 
cal_animal_prod <- cal_animal %>% select(commodity, year, marketings_klbs)
# remove negligible chicken production
cal_animal_prod <- cal_animal_prod %>% filter(commodity != "Chickens")

# convert Keggs to Klbs
egg_wgt <- 0.131
egg_dex <- which(cal_animal_prod[1]=="Eggs")
cal_animal_prod[egg_dex,3] <- cal_animal_prod[egg_dex,3] * egg_wgt

# convert Klbs to Ktons for all animal products
cal_animal_prod[,3] <- cal_animal_prod[,3]/2000
names(cal_animal_prod) <- c(names(cal_animal_prod)[1:2], "marketings_ktons")

# sum production over years of crop data.
cal_total_crop <- cal_crop_prod %>% 
  group_by(commodity) %>%
  summarise(years=n(), production=sum(production_kton))

# load table for crop waste numbers (created by hand)
cal_crop_waste <- read.table(file="calcropwaste.txt", header=TRUE, sep=" ")
cal_crop_waste <- cal_crop_waste[2:6]


# sum production over years of animal data.
cal_total_animal <- cal_animal_prod %>% 
  group_by(commodity) %>%
  summarise(years=n(), production=sum(marketings_ktons))

# create animal waste table by hand, commented out for future runs
#cal_animal_waste <- edit(cal_total_animal)

# save created animal waste table, commented out for future runs
# write.csv(cal_animal_waste, "cal_animal_waste.csv", row.names=FALSE)

# Read in previously created animal waste table
cal_animal_waste <- read.csv(file="cal_animal_waste.csv")

# turn NAs into 0s for crop waste table
index_na2 <- which(is.na(cal_crop_waste[2]))
index_na3 <- which(is.na(cal_crop_waste[3]))
cal_crop_waste[index_na2,2] <- 0.0
cal_crop_waste[index_na3,3] <- 0.0

# Create and save a crop type table by hand, commented out for future runs
# cal_crop_type <- edit(cal_total_crop[1])
# write.csv(cal_crop_type, "cal_crop_type.csv", row.names=FALSE)

# read in crop type file
cal_crop_type <- read.csv(file="cal_crop_type.csv")

# create table with all crop values
cal_crop_full <- merge(cal_total_crop, cal_crop_type, by="commodity", all=TRUE)
cal_crop_full <- merge(cal_crop_full, cal_crop_waste, by="commodity", all=TRUE)

# create table with all animal values
cal_animal_full <- merge(cal_total_animal, cal_animal_waste, by="commodity", all=TRUE)

# remove peppermint and feed, not food products
cal_crop_full <- cal_crop_full %>% filter(commodity != "Peppermint" & commodity != "Hay")

# create crop usage table
cal_crop_use <- 
  data_frame('Commodity'=cal_crop_full$commodity,
             'Type'= cal_crop_full$type,
             'Unharvested'=cal_crop_full$production*cal_crop_full$unharvested,
             'Ugly_and_Blemished'=cal_crop_full$production*cal_crop_full$ugly_blemished,
             'Eaten'=cal_crop_full$production*(1-(cal_crop_full$retail+cal_crop_full$consumer)),
             'Retail_Waste'=cal_crop_full$production*cal_crop_full$retail,
             'Home_Waste'=cal_crop_full$production*cal_crop_full$consumer)

# create animal usage table
cal_animal_use <- 
  data_frame('Commodity'=cal_animal_full$commodity,
             'Eaten'=cal_animal_full$production*(1-(cal_animal_full$Retail+cal_animal_full$Consumer)),
             'Retail_Waste'=cal_animal_full$production*cal_animal_full$Retail,
             'Home_Waste'=cal_animal_full$production*cal_animal_full$Consumer)

# create tables for graphing
cal_crop_graph <- cal_crop_use %>%
  gather(key=Usage, value=Ktons,Eaten,Retail_Waste,Home_Waste)
cal_animal_graph <- cal_animal_use %>%
  gather(key=Usage, value=Ktons,Eaten,Retail_Waste,Home_Waste)

# fix order of usage for proper graph stacking
cal_crop_graph$Usage <- factor(cal_crop_graph$Usage)
cal_crop_graph$Usage <- factor(cal_crop_graph$Usage,
                               levels=c("Home_Waste","Retail_Waste","Eaten"), ordered=TRUE)
cal_animal_graph$Usage <- factor(cal_animal_graph$Usage)
cal_animal_graph$Usage <- factor(cal_animal_graph$Usage,
                               levels=c("Home_Waste","Retail_Waste","Eaten"), ordered=TRUE)

# create reusable themes and legends
theme_crop <-
  theme(axis.text.x = element_text(color="black", size=11, angle=90),
        axis.text.y = element_text(face="bold", color="black", size=10, angle=0),
        plot.title = element_text(face="bold", color="blue", size=16, hjust=0.5),
        axis.title.x = element_text(color="blue3", size=14, face="bold"),
        axis.title.y = element_text(color="coral", size=14, face="bold"))

theme_crop_w <-
  theme(axis.text.x = element_text(color="black", size=9, angle=90),
        axis.text.y = element_text(face="bold", color="black", size=10, angle=0),
        plot.title = element_text(face="bold", color="blue", size=16, hjust=0.5),
        axis.title.x = element_text(color="blue3", size=14, face="bold"),
        axis.title.y = element_text(color="coral", size=14, face="bold"))

theme_crop_sm <- 
  theme(axis.text.x = element_text(color="black", size=11, angle=0),
        axis.text.y = element_text(face="bold", color="black", size=10, angle=0),
        plot.title = element_text(face="bold", color="blue", size=16, hjust=0.5),
        axis.title.x = element_text(color="blue3", size=14, face="bold"),
        axis.title.y = element_text(color="coral", size=14, face="bold"))

 
legend_crop <- scale_fill_manual(name="How Used", 
                                 labels = c("Home Waste", "Retail Waste", "Consumed"), 
                                 values = c("Home_Waste"="orange", 
                                            "Retail_Waste"="yellow", 
                                            "Eaten"="green"))

legend_animal <- scale_fill_manual(name="How Used", 
                                 labels = c("Home Waste", "Retail Waste", "Eaten"), 
                                 values = c("Home_Waste"="orange", 
                                            "Retail_Waste"="yellow", 
                                            "Eaten"="green"))
  
```

First an overall look at all crops produced over the last 5 years for which data is available, 2012-2016.

The names of some of the commodities have suffixes to indicate whether the commodity is destined for fresh market (_FM), to be processed in canning or frozen (_Proc), be used dried (_Dried) like prunes, which or dried plums or dry (_Dry) which separates dried beans from fresh market snap beans.

```{r all_crops, echo=FALSE}
# graph of all crops waste at retail and home level
cal_crop_graph %>% 
  ggplot(aes(x=Commodity,y=Ktons,fill=Usage)) +
  geom_col() +
  labs(title="California Food Crop Production and Waste, 2012-2016", x="Crop",
       y="Production in 1000s of tons") +
  theme_crop_w +
  legend_crop
```
California produces huge amount of processed tomatoes a year, around 12M tons of the US's 14M ton output. California produced more than 60M tons of tomatoes for processing in the 5 year period with over 20M tons going to waste at the home and retail level. 

The second largest crop is grapes for wine,  Waste estimates for grape juice were used for wine, as wine figures weren't available. Likely more wine was wasted, although wine isn't normally thought of as food.
<br><br>
Leaving off the two largest crops allows us to get better detail for the rest of the crops in the next chart.

```{r better_detail, echo=FALSE}
# graph of all crops waste at retail and home level w/o processed tomatoes and wine grapes
cal_crop_graph %>% 
  filter(Commodity != "Tomatoes_Proc" & Commodity != "Grapes_Wine" ) %>%
  ggplot(aes(x=Commodity,y=Ktons,fill=Usage)) +
    geom_bar(stat="identity") +
    labs(title="California Food Crop Production and Waste, 2012-2016\n w/o processed tomatoes and wine grapes",
         x="Crop", y="Production in 1000s of tons") +
    legend_crop + 
    theme_crop_w
```
Lettuce now becomes the number one crop, with over 15M tons produced and 5M tons wasted. California also produces large quantities of oranges, rice and grapes for raisins that show similar waste patterns.
<br><br>
Breaking the chart down into different categories of crops to get some better details:
```{r nuts, echo=FALSE}
# graph of nut crops waste at retail and home level
cal_crop_graph %>% 
  filter(Type=="nut") %>%
  ggplot(aes(x=Commodity,y=Ktons,fill=Usage)) +
    geom_bar(stat="identity") +
    labs(title="California Nut Production and Waste, 2012-2016",
         x="Crop", y="Production in 1000s of tons") +
    legend_crop +
    theme_crop_sm
```
Nuts in general have lower waste, likely due to cost and the less perishable nature of nuts. California produced almost 5M tons of almonds over the 5 years with 1.2M tons wasted. 
<br><br>

```{r grain_etc, echo=FALSE}
# graph of grain, sugar and oil crops and  waste at retail and home level
cal_crop_graph %>% 
  filter(Type=="grain" | Type=="sugar" | Type=="oil") %>%
  ggplot(aes(x=Commodity,y=Ktons,fill=Usage)) +
  geom_bar(stat="identity") +
  labs(title="California Grain, Sugar and Oil Crop Production and Waste, 2012-2016",
       x="Crop", y="Production in 1000s of tons") +
  legend_crop +
  theme_crop_sm

```
Rice is California's major grain crop with almost 11M tons produced and 5M tons wasted. The rice waste figures are one of the few that seem a bit overstated, while wheat seems to be understated, based on the amount of rice and bread thrown away in my household anyway.
<br><br>
```{r fruits, echo=FALSE}
# graph of fruit crop waste at retail and home level w/o wine grapes
cal_crop_graph %>% 
  filter(Type=="fruit" & Commodity != "Grapes_Wine") %>%
  ggplot(aes(x=Commodity,y=Ktons,fill=Usage)) +
  geom_bar(stat="identity") +
  labs(title="California Fruit Production and Waste, 2012-2016 without wine grapes",
       x="Crop", y="Production in 1000s of tons") +
  legend_crop + 
  theme_crop
```
Looking at fruit production, oranges and raisins are major crops with 5 year production/waste numbers of 9.5M/4.5M and 9M/3M tons. Waste estimates for fresh market oranges were used as most of California's oranges are used as produce, while Florida, which produces similar numbers of oranges, sends most of its production to juice. Other major fruit crops produced in California are table grapes and fresh market strawberries. Peaches are divided into clingstone, which are used for canning and freestone which are used as produce, which is the reason for their differing waste percentages.
<br><br>

```{r vegetables, echo=FALSE}
# graph of vegetable crop waste at retail and home level w/o wine grapes
cal_crop_graph %>% 
  filter(Type=="vegetable" & Commodity != "Tomatoes_Proc") %>%
  ggplot(aes(x=Commodity,y=Ktons,fill=Usage)) +
  geom_bar(stat="identity") +
  labs(title="California Vegetable Production and Waste, 2012-2016 without processed tomatoes",
       x="Crop", y="Production in 1000s of tons") +
  legend_crop + 
  theme_crop
```
Vegetable production and waste is led by lettuce. Waste figures for broccoli and cauliflower are likely underestimated due to the USDA's large estimates of unedible portions. The stems of broccoli and cauliflower are often discarded although they are generally edible if well cooked. The waste percentages for fresh market tomatoes also seem low from personal experience. Processed spinach numbers were only available for one year and real figures could be higher as California is the leading producer of spinach in the US.
<br><br>
Finally an overall look at California's crop production and waste based on categories of crop.

```{r crop_type, echo=FALSE}

# compare crops by type
cal_crop_type_graph <- cal_crop_use %>%
  group_by(Type) %>%
  summarise(Eaten=sum(Eaten), Retail_Waste=sum(Retail_Waste), Home_Waste=sum(Home_Waste)) %>%
  gather(key=Usage, value=Ktons,Eaten,Retail_Waste,Home_Waste) 
  
cal_crop_type_graph$Usage <- factor(cal_crop_type_graph$Usage)
cal_crop_type_graph$Usage <- factor(cal_crop_type_graph$Usage,
                               levels=c("Home_Waste","Retail_Waste","Eaten"), ordered=TRUE)

cal_crop_type_graph %>%
  ggplot(aes(x=Type,y=Ktons,fill=Usage)) +
  geom_bar(stat="identity") +
    labs(title="California Crop Production and Waste by Type of Crop, 2012-2016",
         x="Crop Type", y="Production in 1000s of tons") +
    legend_crop +
    theme_crop_sm

```
Vegetables are California's number one crop category with almost 120M tons produced and 50M tons wasted over the 5 year period. Tomatoes are the difference between fruits and vegetables in California. Fruits are the second largest category with 72M tons produced and 26M tons wasted. California produces over 50% of the fruits and vegetables in the US.
<br><br>
Animal based food production and waste in California:

```{r animal, echo=FALSE}

# graph of animal production waste at retail and home level
cal_animal_graph %>% 
  ggplot(aes(x=Commodity,y=Ktons,fill=Usage)) +
  geom_bar(stat="identity") +
  labs(title="California Animal based Food Production and Waste, 2012-2016",
       x="Animal Product", y="Production in 1000s of tons") +
  legend_animal +
  theme_crop_sm

```
Dairy products, milk and cream, are the largest volume animal food produced in California by a large margin, with over 100M tons produced and over 30M tons wasted. California is the leading dairy producing state in the U.S. 

Dairy production is a bit misleading because much of it is processed into other products like cheese, where much of it is evaporated. Dairy production is fairly efficient, however, with most of the nutritional value retained when milk is turned into other products. The one exception is the new fad of Greek yogurt which discards 2-3 pounds of acid whey for every pound of Greek yogurt produced. Fluffiness has it's price. 

The waste percentages on dairy are very conservative, milk home use was not revised in the 2009 study, and retains a 20% value from earlier estimates where everything was 20%. Other products like cheese were revised, but without a breakdown of dairy production use, the 20% figure was used. Milk, however, is a perishable product and the home waste figure overall for dairy is likely closer to the 30% revised values for most cheeses.
<br><br>
Looking at non-dairy animal food products to get more detail:

```{r no_dairy, echo=FALSE}

# graph of animal production waste at retail and home level without Diary
cal_animal_graph %>% 
  filter(Commodity != "Dairy") %>%
  ggplot(aes(x=Commodity,y=Ktons,fill=Usage)) +
  geom_bar(stat="identity") +
  labs(title="California Animal based Food Production and Waste, 2012-2016\n without Dairy Production",
       x="Animal Product", y="Production in 1000s of tons") +
  legend_animal +
  theme_crop_sm

```
Without dairy, we can see that cattle production is the second largest animal product, with almost 6M tons produced and 1.5M tons wasted. Cattle includes cows and calves and calves raised for veal. Veal is very wasteful at retail level as it is a product that stores feel that they need to stock, but is not frequently bought, leading to much of it being thrown away. Fortunately veal production is a very small percentage of overall cattle production. 

Another animal product with a lot of waste is turkey, likely due to the waste around Thanksgiving when everyone buys a turkey, but not all of the meat gets eaten. Pumpkins have a similar waste problem that is likely due to Halloween.

Numbers are not available for California chicken production because most chicken is produced by a single operation. Chicken meat production is likely much less than 1.8M tons a year, as that is the total for California and 10 other states. The USDA waste percentages estimates for chicken are 4% at the retail level and 15% at the home level.
<br><br>
Comparing plant based crops and animal food products production and waste:

```{r anim_crop, echo=FALSE}

# Create combined table to compare animal and crop production and waste.
cal_crop_total_use <- cal_crop_use %>%
  summarise(Type="Crop", Eaten=sum(Eaten), Retail_Waste=sum(Retail_Waste), Home_Waste=sum(Home_Waste))
cal_animal_total_use <- cal_animal_use %>%
  summarise(Type="Animal",Eaten=sum(Eaten), Retail_Waste=sum(Retail_Waste), Home_Waste=sum(Home_Waste))  
cal_total_use <- rbind(cal_crop_total_use,cal_animal_total_use)
cal_total_graph <- cal_total_use %>%
  gather(key=Usage, value=Ktons,Eaten,Retail_Waste,Home_Waste)
cal_total_graph$Usage <- factor(cal_total_graph$Usage)
cal_total_graph$Usage <- factor(cal_total_graph$Usage,
                                    levels=c("Home_Waste","Retail_Waste","Eaten"), ordered=TRUE)


# Compare animal products to crops
cal_total_graph %>% 
  ggplot(aes(x=Type,y=Ktons,fill=Usage)) +
  geom_bar(stat="identity") +
  labs(title="California Crop and Animal Production and Waste, 2012-2016",
       x="Product Type", y="Production in 1000s of tons") +
  legend_crop +
  theme_crop_sm +
  geom_text(aes(label=paste(round(Ktons/1000, 1),"M Tons"),
                y=c(140000,70000,161000,85000, 220000, 105000))) +
  geom_text(aes(label=paste("Total Consumed:",paste(round((Ktons[1]+Ktons[2])/1000, 1),"M Tons"),sep='\n'),
                y=150000, x="Animal"), color="green", size=6) +
  geom_text(aes(label=paste("Total Home and","Retail Waste:",paste(round(sum(Ktons[3:6])/1000, 1),"M Tons"), sep='\n'),
                y=200000, x="Animal"), color="goldenrod1", size=6)

```
One third of the food produced in California is wasted at the home and retail level. Although a lower percentage of animal based food is wasted, animal based food production is much more expensive in resources and has a greater environmental impact.

Comparing Animal products to crops is a bit confusing as the USDA production figures include only the edible portions for meat and both the inedible and edible portions for crops. Depending on the crop inedible loss can be anywhere from 0% for grains, from 6% for strawberries to 50% for grapefruit in fruits and from 3% for mushrooms to 64% for fresh corn in vegetables. So the addage of the difficulty of comparing apples to oranges applies here. In addition over 50% of an animal is inedible for meat products, and dairy is used to make other products where much of the weight is evaporated or removed. The waste percentages are accurate, but the overall tonnage may be misleading.
<br><br>

### Comparing costs of animal food products to crop based foods.
The CDFA *California Agricultural Statistics Review* does provide some data that can allow comparison of the cost of producing animal based food versus the cost of producing plant based food. Yearly totals for the value of animal based food and plant based food are provided and farm origin and manufactured inputs are generally clear as to their destination in either crop or livestock production. Costs for labor, capital equipment and marketing are intermingled, but are likely similar for both animal and plant based food.

Total costs for seed, fertizer, pesticides and fuel were assigned to crops, costs for purchased livestock, feed and electricity were assigned to animals. 

The following charts show year by year input costs for these resources and produced food values for livestock and crops:

```{r graph2_setup, include=FALSE}

# look at comparable costs to produce animal vs. plant based products
# reduce table to total production and seperable inputs for crops and livestock
cost_comp <-  ag_bal %>%
  filter(Item %in% c("Crop_Value_Total","Livestock_Value_Total","Feed_purchased",
                     "Livestock_poultry_purchased","Seed_purchased","Fertilizers_lime",
                     "Pesticides","Petroleum_fuel","Electricity"))

# flip table so years are observations, convert $1000 values to numerics
cost_comp <- t(cost_comp)
colnames(cost_comp) <- cost_comp[1,]
cost_df <- data_frame(year=rownames(cost_comp)[2:6],cost_comp[2:6,1],cost_comp[2:6,2],
                      cost_comp[2:6,3],cost_comp[2:6,4],cost_comp[2:6,5],cost_comp[2:6,6],
                      cost_comp[2:6,7],cost_comp[2:6,8],cost_comp[2:6,9])
colnames(cost_df)[2:10] <- colnames(cost_comp)
for (i in 2:10) {
  cost_df[i] <- as.numeric(cost_df[[i]])
}
# Sum costs for crops and livestock
cost_df <- cost_df %>%
  mutate(Crop_Cost_Total=Seed_purchased+Fertilizers_lime+Pesticides+Petroleum_fuel,
         Livestock_Cost_Total=Feed_purchased+Livestock_poultry_purchased+Electricity)

# create reduced table with ratio of cost to total value
cost_red <- cost_df %>%
  select(1:3,11:12)
cost_red <- cost_red %>%
  mutate(Crop_Cost_Ratio=Crop_Cost_Total/Crop_Value_Total, 
         Livestock_Cost_Ratio=Livestock_Cost_Total/Livestock_Value_Total)

cost_red$year <- as.integer(str_sub(cost_red$year,2,5))
  
```

```{r crop_cost, echo=FALSE}

# show year by year graph of cost of crop production
cost_red %>% 
  ggplot(aes(x=year,y=Crop_Value_Total/1000000)) +
  geom_col(fill ="blue", color="black") +
  geom_col(data = cost_red, aes(x=year, y=Crop_Cost_Total/1000000), fill="goldenrod", color="black") +
  labs(title="California Crop Value and Cost of inputs, 2012-2016\n without labor, marketing and capital equipment costs",
       x="Year", y="Value in Billions of Dollars") +
  coord_flip() +
  theme_crop_sm + 
  geom_text(aes(label=paste(round(Crop_Value_Total/1000000, 1),"B"),
                y=Crop_Value_Total/1000000+1.5)) +
  geom_text(aes(label=paste(round(Crop_Cost_Total/1000000, 1),"B"),
                y=Crop_Cost_Total/1000000-1.3))+
  geom_text(aes(label="Cost of Inputs", x=2016.7,y=4.5), size= 6, color="goldenrod") +
  geom_text(aes(label="Total Value", x=2016.7,y=30), size= 6, color="blue")

```
<br><br>
```{r animal_cost, echo=FALSE}

# show year by year graph of cost of livestock production
cost_red %>% 
  ggplot(aes(x=year,y=Livestock_Value_Total/1000000)) +
  geom_col(fill ="blue", color="black") +
  geom_col(aes(x=year, y=Livestock_Cost_Total/1000000), fill="goldenrod", color="black") +
  labs(title="California Animal Product Value and Cost of inputs, 2012-2016\n without labor, marketing and capital equipment costs",
       x="Year", y="Value in Billions of Dollars") +
  coord_flip() +
  theme_crop_sm + 
  geom_text(aes(label=paste(round(Livestock_Value_Total/1000000, 1),"B"),
                y=Livestock_Value_Total/1000000+.6)) +
  geom_text(aes(label=paste(round(Livestock_Cost_Total/1000000, 1),"B"),
                y=Livestock_Cost_Total/1000000-.6))+
  geom_text(aes(label="Cost of Inputs", x=2016.7,y=2.5), size= 6, color="goldenrod") +
  geom_text(aes(label="Total Value", x=2016.7,y=13), size= 6, color="blue")


```
For crops the value of production to input cost ratio varies from 16-20%. For livestock the value of ranges from 44 to 63%. The resources required to produce the same value of animal based food is 2 to 3 times the resources required to produce plant based food in California.
<br><br>

### Preproduction Waste in Produce Due to Ugliness, Blemishes or Size
Produce is often rejected by retail buyers due to weird shapes, blemishes or the desire to have a standard size. 

Estimates of how much produce is wasted range from 10-15% deemed not worth harvesting and 20-30% rejected by retailers and either thrown away or fed to animals. Unfortunately there is no government or standard body to produce estimates in this area so ancedotal estimates from farmers and companies trying to create a market for this produce are relied on.

Conservative figures of 10% unharvested and 20% rejected by retailers were used for the following charts. The charts are based on the assumption that rejected produce is not accounted for in USDA production numbers as full value is not realized for rejected fruits. For unharvested produce this assumption is certainly true, but there is no indication whether the USDA includes unused produce in its production numbers or not.

```{r graph3_setup, include=FALSE}

# create 2015 produce production table
wonky_2015 <- data_frame(commodity=rep(c("Fruit", "Citrus", "Vegetable"),2))
wonky_2015$region <- c(rep("US",3), rep("California",3))
wonky_2015$marketable <- c(14078,3794,21762, sum(crop_2015[c(25:34,36,37,39,41,42,44:46,49,50),5]), 
                        3138, sum(crop_2015[1:22,5]))
wonky_2015 <- wonky_2015 %>%
  mutate(unharvest = marketable*0.1, discard = marketable*0.2)

# create produce table for visualization
wonky_graph <- wonky_2015 %>%
  gather(key=use, value=Ktons,marketable,unharvest,discard) 
wonky_graph$use <- factor(wonky_graph$use)
wonky_graph$use <- factor(wonky_graph$use,
                                levels=c("discard","unharvest","marketable"), ordered=TRUE)

# create legend and theme for wonkey
legend_wonky <- scale_fill_manual(name="Produce Destination\nDue to Appearance ", 
                                 labels = c("Harvested but\nnot Marketable", "Not Harvested", "Marketable"), 
                                 values = c("discard"="chartreuse3", 
                                            "unharvest"="darkseagreen1", 
                                            "marketable"="blue"))

theme_wonky <-
  theme(axis.text.x = element_text(face="bold", color="maroon", size=10, angle=0),
        axis.text.y = element_text(face="bold", color="black", size=10, angle=0),
        plot.title = element_text(face="bold", color="blue", size=16, hjust=0.5),
        axis.title.x = element_text(color="coral", size=14, face="bold"),
        axis.title.y = element_text(color="coral", size=14, face="bold"))

```


```{r cal_produce, echo=FALSE}

# Graph California Ugly produce
wonky_graph %>% 
  filter(region=="California") %>%
  ggplot(aes(x=commodity,y=Ktons,fill=use)) +
  geom_bar(stat="identity") +
  labs(title="California Produce Discarded or Unharvested\ndue to Blemishes, Ugliness or Size, 2015",
       x="Produce Type", y="Production in 1000s of tons") +
  legend_wonky +
  theme_wonky +
  geom_text(aes(label=paste(round(Ktons, 0),"KTons"),
                y=c(6200,2900,10000,6900,3350,11000,8200,3900,13000)), size=3.5) 

```
<br><br>
```{r US_produce, echo=FALSE}

# Graph US Ugly produce
wonky_graph %>% 
  filter(region=="US") %>%
  ggplot(aes(x=commodity,y=Ktons,fill=use)) +
  geom_bar(stat="identity") +
  labs(title="US Produce Discarded or Unharvested\ndue to Blemishes, Ugliness or Size, 2015",
       x="Produce Type", y="Production in 1000s of tons") +
  legend_wonky +
  theme_wonky +
  geom_text(aes(label=paste(round(Ktons, 0),"KTons"),
                y=c(13500,3400,21000,15000,4200,23000,17600,5500,27000)), size=3.5) 
```
<br><br>
```{r total_produce, echo=FALSE}
# Total all types of produce
wonky_graph %>%  
  group_by(region, use) %>%
  summarize(Ktons=sum(Ktons)) %>%
  ggplot(aes(x=region,y=Ktons,fill=use)) +
  geom_bar(stat="identity") +
  labs(title="Total Produce Discarded or Unharvested\ndue to Blemishes, Ugliness or Size, 2015",
       x="Total Produce", y="Production in 1000s of tons") +
  legend_wonky +
  theme_wonky +
  geom_text(aes(label=paste(round(Ktons, 0),"KTons"),
                y=c(24000,21000,18000,50000,42000,38000)), size=3.5) 
```
Numbers from 2015 were used because more recent years don't seperate fresh market vegetables from processed vegetables.

Only the numbers for fresh market vegetables were used because tomatoes are the majority of processed vegetables and are used for things that don't require perfect produce like tomato based sauces. 

Only fresh market citrus was used because processed citrus is mostly used for juice. 

For other fruits, processed and fresh market were combined as canned and dried fruits are often held to appearance standards and separate numbers were not available. 

USDA annual crop reports were used for the US production numbers and the *California Agricultural Statistics Review* was used for California production numbers.
<br><br>

## Conclusion
Over the last 5 years of available data, California produced 68M tons of food annually. At the retail and home levels, 23M tons of this produce or more was wasted annually. In addition 6M Tons of produce or more was wasted annually because it didn't meet retail standards of beauty. From these numbers 39% of the food that California produces is wasted annually.
<br><br><br><br>
